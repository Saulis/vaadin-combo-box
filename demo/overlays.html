<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>

    <link rel="import" href="../x-vaadin-overlay.html">
    <link rel="import" href="../x-vaadin-dropdown.html">
    <link rel="import" href="../x-vaadin-list.html">
    <link rel="import" href="../x-vaadin-combo-box.html">

    <link rel="import" href="common.html">

  </head>
  <body>

  <div class="vertical-section-container centered">
    <h3>Dialog</h3>

    <demo-snippet>
      <template>
        <x-vaadin-dialog></x-vaadin-dialog>
      </template>
    </demo-snippet>

    <h3>Dropdown</h3>

    <demo-snippet>
      <template>
        <x-vaadin-dropdown-menu></x-vaadin-dropdown-menu>
      </template>
    </demo-snippet>

    <h3>Menu Button</h3>

    <demo-snippet>
      <template>
        <x-vaadin-menu-button></x-vaadin-menu-button>
      </template>
    </demo-snippet>

    <h3>Listbox</h3>

    <demo-snippet>
      <template>
        <x-vaadin-listbox></x-vaadin-listbox>
      </template>
    </demo-snippet>

    <h3>Combobox</h3>

    <demo-snippet>
      <template>
        <x-vaadin-combo-box items='["foo", "bar", "baz"]'></x-vaadin-combo-box>
      </template>
    </demo-snippet>
  </div>


  <dom-module id="x-vaadin-dialog">
    <template>
      <style>
        :host {
          display: block;
        }
      </style>
      <x-vaadin-overlay id="overlay" style="top: 50%;left: 50%;transform: translate3d(-50%, -50%, 0);">
        <template slot="template">
         <div style="height: 200px; width: 500px">
           <button on-tap="_close">Close</button>
         </div>
       </template>
      </x-vaadin-overlay>
      <button on-tap="_open">Open</button>
    </template>
    <script>
      Polymer({
        is: 'x-vaadin-dialog',

        _open: function() {
          this.$.overlay.opened = true;
        },

        _close: function() {
          this.$.overlay.opened = false;
        }
      });
    </script>
  </dom-module>

  <dom-module id="x-vaadin-dropdown-menu">
    <template>
      <style>
        :host {
          display: block;
        }
      </style>
      <label id="label" tabindex="0" on-tap="_open">[[selected]]</label>
      <x-vaadin-dropdown id="dropdown" opened="{{opened}}">
        <template>
          <style>
            x-vaadin-list {
              width: 100px;
            }
          </style>
          <x-vaadin-list id="list" items="[[items]]"
            on-selected-item-changed="_selectionChanged"
            on-click="_close"
            key-event-target="[[_keyEventTarget]]"></x-vaadin-list>
        </template>
      </x-vaadin-dropdown>
    </template>
    <script>
      Polymer({
        is: 'x-vaadin-dropdown-menu',

        behaviors: [Polymer.IronA11yKeysBehavior],

        properties: {
          selected: String,
          opened: Boolean
        },

        keyBindings: {
          'esc': '_onEsc',
          'enter': '_onEnter'
        },

        ready: function() {
          this.selected = 'Select Value';
          this._keyEventTarget = this.$.label;
          this.$.dropdown.positionTarget = this.$.label;
          this.items = ['foo', 'bar', 'baz'];
        },

        _open: function(e) {
          this.$.dropdown.opened = true;
        },

        _selectionChanged: function(e) {
          this.selected = e.detail.value;

          // TODO: quick hack to bypass the opening caused by enter.
          this.async(function() {
            this._close();
          }, 1);
        },

        _onEsc: function(e) {
          this._close();
        },

        _onEnter: function(e) {
          this.opened = true;
        },

        _open: function(e) {
          this.opened = true;
        },

        _close: function(e) {
          this.opened = false;
        }
      });
    </script>
  </dom-module>


  <dom-module id="x-vaadin-menu-button">
    <template>
      <style>
        :host {
          display: block;
        }
      </style>
      <button id="button" on-tap="_open">Show</button>
      <x-vaadin-dropdown id="dropdown" opened="{{opened}}">
        <template>
          <style>
            x-vaadin-list {
              width: 100px;
            }
          </style>
          <x-vaadin-list items="[[items]]" on-click="_close" key-event-target="[[_keyEventTarget]]"></x-vaadin-list>
        </template>
      </x-vaadin-dropdown>
    </template>
    <script>
      Polymer({
        is: 'x-vaadin-menu-button',

        behaviors: [Polymer.IronA11yKeysBehavior],

        properties: {
          opened: Boolean
        },

        keyBindings: {
          'esc': '_onEsc',
          'enter': '_onEnter'
        },

        ready: function() {
          this._keyEventTarget = this.$.button;
          this.$.dropdown.positionTarget = this.$.button;
          this.items = ['foo', 'bar', 'baz'];
        },

        _onEsc: function(e) {
          this._close();
        },

        _onEnter: function(e) {
          if (this.opened) {
            e.preventDefault();
            this._close();
          }
        },

        _open: function(e) {
          this.opened = true;
        },

        _close: function(e) {
          this.opened = false;
        }
      });
    </script>
  </dom-module>

  <dom-module id="x-vaadin-listbox">
    <template>
      <style>
        :host {
          display: block;
        }

        x-vaadin-list:focus {
          outline: none;
        }

        x-vaadin-list {
          border: 1px solid black;
          width: 200px;
        }
      </style>
      <x-vaadin-list id="list" tabindex="0" items="[[items]]" loading="[[loading]]"></x-vaadin-list>
    </template>
    <script>
      Polymer({
        is: 'x-vaadin-listbox',

        properties: {
          filter: String,
          loading: Boolean
        },

        // listeners: {
        //   'keydown': '_onKeydown'
        // },

        observers: ['_filterChanged(filter)'],

        attached: function() {
          this.filter = '';
          // this.$.list.keyEventTarget = this;
        },

        _onKeydown: function(e) {
          console.log(e);
          this.$.list._onKeydown(e);
        },

        _filterChanged: function(filter) {
          this.loading = true;

          this.items = ['foo', 'bar', 'baz'].filter(function(item) {
            return !item || item.indexOf(filter) >= 0;
          });

          console.log(this.items);

          this.async(function() {
            this.loading = false;
          }, 100);
        }
      });
    </script>
  </dom-module>
  </body>
</html>
